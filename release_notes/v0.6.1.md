## v0.6.1

### Internal refactor — `FlowBuilder` (no breaking changes)

#### Execution engine split into focused methods

`_execute` was a ~150-line monolith handling the step loop, signal checks, timeout, hook middleware, step dispatch, goto resolution, and error wrapping all in one place. It is now split into three methods with a single responsibility each:

- `_execute` — the for-loop, `AbortSignal` checks, `beforeStep`/`afterStep` hook calls, goto resolution, and `FlowError` wrapping
- `_runStep` — applies `timeoutMs` and the `wrapStep` middleware chain, then delegates to `_dispatchStep`
- `_dispatchStep` — pure `switch` on `step.type`; no timeout, no wrapping, no error handling

#### Parallel execution extracted

The parallel fan-out logic was inlined as a `case "parallel"` block. It is now its own `_runParallel` method, making the two execution modes (with/without `reducer`) clearly separated.

#### Module-level pure functions

The following were private instance methods with no dependency on `this`. Moving them to module scope makes them independently testable and reduces class surface area:

- `resolveNumber` (was `_res`)
- `retry` (was `_retry`)
- `withTimeout` (was `_withTimeout`)
- `isAnchorTarget`, `runFnResult`, `buildAnchorMap` — extracted from inline / scattered usage

#### Hook cache simplified

`_hooks()` is now a one-liner using `??=`, delegating to the existing `buildHookCache` function. Cache invalidation on `_setHooks` is unchanged.

#### Bug fix — `retry` missing `throw`

The `throw err` statement inside `retry` was accidentally omitted, meaning a failed final attempt would silently continue instead of rejecting. Fixed:

```ts
// before
if (!--times)
if (delaySec > 0) ...

// after
if (!--times) throw err;
```
